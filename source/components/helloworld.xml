<?xml version="1.0" encoding="utf-8" ?>
<component name="HelloWorld" extends="Scene"> 
	<children>
	     <!-- SRVBC Logo at top left -->
	     <Poster id="logoImage"
	       uri="pkg:/images/srvbc-logo.png"
	       translation="[50, 50]"
	       width="600"
	       height="100" />
	     
	     <!-- Main UI Container -->
	     <Group id="mainLayout"
	       translation="[240, 300]">
	       
	       <Button id="playButton"
	         text="Play Live Stream"
	         translation="[-100, 80]"
	         width="200"
	         height="50" />
	         
	     </Group>
      
      <!-- Video Player (initially hidden) -->
      <Video id="videoPlayer"
        width="1280"
        height="720"
        translation="[0, 0]"
        visible="false"
        enableUI="true" />
        
    </children>
    
<!-- BrightScript Portion -->
<script type="text/brightscript" >
<![CDATA[
  '** 
  '** Live Streaming Roku App
  '** Loads HLS stream when Play Live Stream button is pressed
  '**

  function init()
    print "HelloWorld: init()"
    m.top.setFocus(true)
    
    ' Get references to UI elements
    m.playButton = m.top.findNode("playButton")
    m.videoPlayer = m.top.findNode("videoPlayer")
    m.mainLayout = m.top.findNode("mainLayout")
        
    ' Set initial focus to button
    m.playButton.setFocus(true)
    
    ' Set up event observers
    m.playButton.observeField("buttonSelected", "onButtonSelected")
    m.videoPlayer.observeField("state", "onVideoStateChange")
    
    ' Set up key event handling
    m.top.observeField("focusedChild", "onFocusChanged")
    
    print "HelloWorld: init() complete"
  end function
  
  function onButtonSelected(event as object)
    print "HelloWorld: onButtonSelected() - Play Live Stream button pressed"
    playLiveStream()
  end function
  
  function playLiveStream()
    print "HelloWorld: playLiveStream()"
    
    ' Create content node for HLS stream
    content = CreateObject("roSGNode", "ContentNode")
    content.url = "https://live.srvbc.org/hls/live.m3u8"
    content.streamFormat = "hls"
    content.title = "SRVBC Live Stream"
    
    ' Hide main UI and show video player
    m.mainLayout.visible = false
    m.videoPlayer.visible = true
    m.videoPlayer.setFocus(true)
    
    ' Start playback
    m.videoPlayer.content = content
    m.videoPlayer.control = "play"
    
    print "HelloWorld: Starting HLS stream playback"
  end function
  
  function onVideoStateChange(event as object)
    state = event.getData()
    print "HelloWorld: Video state changed to: "; state
    
    if state = "error" then
      print "HelloWorld: Video playback error occurred"
      returnToMainMenu()
    else if state = "finished" then
      print "HelloWorld: Video playback finished"
      returnToMainMenu()
    end if
  end function
  
  function returnToMainMenu()
    print "HelloWorld: returnToMainMenu()"
    
    ' Stop video and hide player
    m.videoPlayer.control = "stop"
    m.videoPlayer.visible = false
    
    ' Show main UI and set focus
    m.mainLayout.visible = true
    m.playButton.setFocus(true)
  end function
  
  function onKeyEvent(key as string, press as boolean) as boolean
    print "HelloWorld: onKeyEvent() - key: "; key; " press: "; press
    
    if press then
      if key = "back" then
        if m.videoPlayer.visible then
          ' If video is playing, return to main menu
          returnToMainMenu()
          return true
        else
          ' If on main menu, exit app
          return false
        end if
      end if
    end if
    
    return false
  end function
  
  function onFocusChanged(event as object)
    ' Handle focus changes if needed
    print "HelloWorld: Focus changed"
  end function
  
]]>
</script>
<!-- End of BrightScript Portion -->
</component>
